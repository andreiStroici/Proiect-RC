###### [<< Înapoi la cuprins](../Cuprins.md)
######  [< QoS](03.%20QoS.md) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [CONNACK >](05.%20CONNACK.md) 
### Pachetul CONNECT
#### După ce s-a realizat conețiunea de rețea dintre client și broker, acesta este primul pachet trimis de client către server. Pachetul CONNECT poate fi trimis o singură dată, iar dacă în cadrul acestui proces va apărea o eroare, brokerul va închide conețiunea de rețea. Structura acestui pachet este:
1. **Antetul fix**
    - **Tip**: 1 octet (0001 0000).
    - **Lungimea**: Variable Byte Integer (lungimea antetului variabil + payload).

2. **Antetul variabil**
    - **Numele protocolului**:
        - 1 octet: 0x00 (indică începutul string-ului).
        - 1 octet: 0x04 (lungimea numelui protocolului).
        - 4 octeți: "MQTT" (0x4D, 0x51, 0x54, 0x54).
    - **Versiunea protocolului**: 1 octet (0x05).
    - **Flag-urile de conectare**: 1 octet.
        - Bit 7: User Name Flag.
        - Bit 6: Password Flag.
        - Bit 5: Will Retain.
        - Biții 4-3: QoS (calitatea serviciului).
        - Bit 2: Will Flag.
        - Bit 1: Clean Start.
        - Bit 0: Rezervat (0).
    - **Keep Alive**: 2 octeți (numărul de secunde pentru păstrarea conexiunii).
    - **Proprietățile conexiunii**:
        - **Lungimea proprietății**: Variable Byte Integer.
        - **Timpul de expirare al sesiunii**: 4 octeți.
        - **Maxim de primire**: 2 octeți.
        - **Dimensiunea maximă a pachetului**: 4 octeți.
        - **Topic Alias Maximum**: 2 octeți.
        - **Cerere pentru informații despre răspuns**: 1 octet (0 sau 1).
        - **Solicitare informații despre erori**: 1 octet (0 sau 1).
        - **Proprietățile utilizatorului**: 1 octet (care este idetificatorul proprietății utilizatorului) și o pereche de șiriuri de caractere codificate cu UTF-8.
        - **Metoda de autetificare**: 1 octet (identificatorul metodei de autetificare) și urmat de un șir de caractere codificat folosind UTF-8.
        - **Datele de autentificare**: 1 octet (idetificatorul datelor de autentificare) urmat de un Binary Data (care conține datele de autentificare).
3. **Payload** 
    - **Identificatorul clientului**: șir de caractere
    - **Proprietăți Will**: compus din
        - **Lungimea proprietății**: Variable Integer Byte.
        - **Interval de întârziere pentru Will**: compus din:
            - **Idetificatorul intervalului de întârziere pentru Will**: 1 octet
            - **Durata intervalului**: întreg memorat pe 4 octeți.
        - **Identificatorul de format al Payload**: compus din:
            - **Identificator pentru formatul Payload-ului**: 1 octet.
            - **Valoarea formatului**: un octet.
        - **Durata de expirare a mesajului**: compus din:
            - **Identificator pentru durata de expirare a intervalului**: 1 octet.
            - **Valoarea intervalului**: un întreg memorat pe 4 octeți.
        - **Tipul conținutului**: compus din:
            - **Identificator pentru tipul conținutului**: 1 octet.
            - **Conținutul mesajului Will**: un șir de caractere.
        - **Topicul de răspuns**: compus din:
            - **Identificatorul topicului**: 1 octet.
            - **VȘir de caractere utilizat pentru topicul de răspuns**: un șir de caractere.
        - **Datele de corelare**: compus din:
            - **Identificator pentru datele de corelare**: 1 octet.
            - **Valoarea formatului**: Binary Data.
        - **Proprietatea utilizatorului**: compus din:
            - **Identificator pentru proprietatea utilizatorului**: 1 octet.
            - **Proprietatea**: Binary Data.
        - **Topicul Will**:  șir de caractere.
        - **Will Payload**: Binary Data.
        - **Numele utilizatorului**: șir de caractere.
        - **Parolă**: Binary Data.